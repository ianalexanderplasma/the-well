<!DOCTYPE html>
<html>
<head>
	<title>The Well - Live</title>
	<script src='https://meet.jit.si/external_api.js'></script>
</head>

<style type="text/css">

	html, body {
		margin: 0;
		padding:0; 
	}

	#iframe-container {
		height: calc(95vh - 41px);
	}

	#logo {
		text-align: center;
		font-family: 'Karla', sans-serif;

	}

	#largeVideoContainer {
		background-color: #000 !important;
	}
	
</style>

<body>

	<h1 id="logo">THE<span style="font-size: 36px; color: #2752ff;">‚óè</span>WELL</h1>

	<div id="iframe-container"></div>

</body>

<script type="text/javascript">

// We use a UUID to create a unique param and add it to the calendar invite
// Example: https://thewell.network/meet?id=well-4ff2dfa7-6bf9-4142-afd7-0e18be63e068

// Get the param from the URL
const queryString = window.location.search;
const urlParams = new URLSearchParams(queryString);
const meeting_id = urlParams.get('id');

// Get user info to set display name
var username  = 'Ian';

// Use the meeting param to construct the Jitsi iframe
const domain = 'meet.jit.si';
const options = {
    roomName: meeting_id,
    width: '100%',
    height: '100%',
    parentNode: document.querySelector('#iframe-container')
};

const api = new JitsiMeetExternalAPI(domain, options);

// Set new password for channel
api.addEventListener('participantRoleChanged', function(event) {
    if (event.role === "moderator") {
        api.executeCommand('password', 'well');
    }
});

// Join a protected channel
api.on('passwordRequired', function (){
    api.executeCommand('password', meeting_id);		// we could make this an actual pass instead  of the meeting id but seems like a decent roadblock to prevent access
});

// Set the subject of the conference
api.executeCommand('subject', 'The Well');

// Set my display name
api.executeCommand('displayName', username);

// Invite new participants to the call with the following API function:
// api.invite([ {...}, {...}, {...} ]).then(() => {
//     // success
// }).catch(() => {
//     // failure
// });


// dominantSpeakerChanged - receives event notifications about change in the dominant speaker. The listener will receive object with the following structure:

// participantJoined - event notifications about new participants who join the room. The listener will receive an object with the following structure:

api.addEventListener(participantJoined, console.log('JOINED!'));

api.addEventListener(dominantSpeakerChanged, listener);


</script>
</html>